# 3. 더 높은 목표치를 Scale Out으로 해결

## 🆘 문제

<aside>
⚠️ 문제 : 단일 인스턴스로 프로젝트 목표인 1000 TPS를 초과하는 것은 한계가 있다고 판단했습니다.

</aside>

| 라벨 | 표본 수 | 평균 응답 속도 | 최소값 | 최대값 | 표준편차 | 오류 % | 처리량(tps) | 수신 KB/초 | 전송 KB/초 | 평균 바이트 수 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Redis 캐시 적용 | 10000 | 11492ms | 127 | 20504 | 5469.811458239943 | 0.0 | 333.8452293516726 | 117.02644575849637 | 135.95064515590573 | 358.954 |

## 👁‍🗨 분석

<aside>
💡 동일한 스펙의 추가 서버를 배치하여 부하를 분산하는 Scale-out 전략을 적용함으로써, 비용 대비 성능 향상을 효과적으로 달성할 수 있다고 생각했습니다.

</aside>

[가비아 라이브러리](https://library.gabia.com/contents/infrahosting/1222/)

[스케일 아웃과 스케일 업 비교 | Microsoft Azure](https://azure.microsoft.com/ko-kr/resources/cloud-computing-dictionary/scaling-out-vs-scaling-up/#overview)

<aside>
🔥 프로젝트는 AWS EC2 서버를 활용하여 배포되고 있기 때문에, AWS Load Balancer 기능을 사용해 부하 분산이 유리하다고 판단했습니다. 로드 밸런서 중 OSI 모델의 레이어 7(Application layer)에서 작동하는 Application Load Balancer가 있습니다. 이 Application Load Balancer는 웹 애플리케이션 및 RESTful API에 대해 더 유연하고 다양한 기능을 제공하므로, AWS Application Load Balancer를 사용하여 TPS를 향상하는 것이 적절하다고 생각했습니다.

</aside>

[What is an Application Load Balancer? - Elastic Load Balancing](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html)

[🗼 OSI 7계층 모델 - 핵심 총정리](https://inpa.tistory.com/entry/WEB-🌐-OSI-7계층-정리)

![스크린샷 2023-04-25 오전 12.24.42.png](3%20%E1%84%83%E1%85%A5%20%E1%84%82%E1%85%A9%E1%87%81%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%A9%E1%86%A8%E1%84%91%E1%85%AD%E1%84%8E%E1%85%B5%E1%84%85%E1%85%B3%E1%86%AF%20Scale%20Out%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%92%E1%85%A2%E1%84%80%E1%85%A7%E1%86%AF%20bec5d753bb48430eac90d9cd92ea8e6a/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-04-25_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%258C%25E1%2585%25A5%25E1%2586%25AB_12.24.42.png)

## 🌟시도

### ※ 동일한 스펙의 인스턴스 2개를 생성하고 프로젝트 배포

![스크린샷 2023-05-06 오후 5.49.35.png](3%20%E1%84%83%E1%85%A5%20%E1%84%82%E1%85%A9%E1%87%81%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%A9%E1%86%A8%E1%84%91%E1%85%AD%E1%84%8E%E1%85%B5%E1%84%85%E1%85%B3%E1%86%AF%20Scale%20Out%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%92%E1%85%A2%E1%84%80%E1%85%A7%E1%86%AF%20bec5d753bb48430eac90d9cd92ea8e6a/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-05-06_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_5.49.35.png)

### ※ 로드 밸런서 생성

![스크린샷 2023-05-06 오후 6.06.27.png](3%20%E1%84%83%E1%85%A5%20%E1%84%82%E1%85%A9%E1%87%81%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%A9%E1%86%A8%E1%84%91%E1%85%AD%E1%84%8E%E1%85%B5%E1%84%85%E1%85%B3%E1%86%AF%20Scale%20Out%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%92%E1%85%A2%E1%84%80%E1%85%A7%E1%86%AF%20bec5d753bb48430eac90d9cd92ea8e6a/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-05-06_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_6.06.27.png)

### ※ 배포 되어 있는 서버를 로드 밸런서 타켓에 포함

![스크린샷 2023-05-06 오후 6.06.12.png](3%20%E1%84%83%E1%85%A5%20%E1%84%82%E1%85%A9%E1%87%81%E1%84%8B%E1%85%B3%E1%86%AB%20%E1%84%86%E1%85%A9%E1%86%A8%E1%84%91%E1%85%AD%E1%84%8E%E1%85%B5%E1%84%85%E1%85%B3%E1%86%AF%20Scale%20Out%E1%84%8B%E1%85%B3%E1%84%85%E1%85%A9%20%E1%84%92%E1%85%A2%E1%84%80%E1%85%A7%E1%86%AF%20bec5d753bb48430eac90d9cd92ea8e6a/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-05-06_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_6.06.12.png)

## 💡 해결

<aside>
🛠 서버 인스턴스 2대로 10K 요청 테스트 진행 시 평균 응답속도 3178ms(713 tps)로 비관적 락 대비 약 93.6% 속도 개선.

</aside>

[230424  8번째 테스트(EC2 2개+로드밸런서 적용)](https://www.notion.so/230424-8-EC2-2-ec0397e6d75e4ca8971ea3ea45348da8) 

| 라벨 | 표본 수 | 평균 응답 속도 | 최소값 | 최대값 | 표준편차 | 오류 % | 처리량
(tps) | 수신 KB/초 | 전송 KB/초 | 평균 바이트 수 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 로드 밸런서 적용 | 10000 | 3178
ms | 111 | 7210 | 1250.0635177903519 | 0.0 | 713.1141695785495 | 233.2941863367325 | 323.8262586465093 | 335.0 |